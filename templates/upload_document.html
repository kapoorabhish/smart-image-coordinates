{%extends "base.html"%}

{%block main_block%}
<h1>
    <center>Upload Document</center>
</h1>
<div class="col-sm-12 col-xs-12 col-md-offset-4 col-lg-offset-4 col-lg-4 col-md-4">
    <p> <a href = "{%url 'create-category'%}"><button class="btn btn-primary pull-left">Create Category</button></a></p>
    <p style = "margin-top:50px;margin-bottom:50px"><a href = "{%url 'create-template'%}"><button class="btn btn-primary pull-left" >Create Template</button></a></p>
</div>
<form class = "form-horizontal col-sm-12 col-md-offset-4 col-lg-4 col-md-offset-4 col-lg-offset-4 col-xs-12" action = "{{request.path}}" method="post" enctype="multipart/form-data" style = "margin-top:50px">
  {%csrf_token%}
  {{form.as_p}}
  <input type = "submit" value = "Upload Document" class = "btn btn-primary col-sm-12"/>
</form>
<script type = "text/javascript">
  $(document).ready(function(){
    update_template_list();
     $("#id_category").change(function(){
         update_template_list();
     });
  });
function update_template_list(){
         var category = $("#id_category").val();
         console.log("category = "+ category);
         $.get("/get_template/"+ category, function(data){
            if(data["error"] == "true")
            {
               alert(data["message"]);
            }
            else{
               str = JSON.parse(data["data"]);
               new_rows = "";
               for(i=0; i<str.length; i++)
               {
                   new_row_string = '<option value="' + str[i]["fields"]["slug"] + '">' + 
                       str[i]["fields"]["template_name"]+'</option>';
                   new_rows += new_row_string;
               }
               $("#id_template").html(new_rows);
            }
        });
}
</script>
{%endblock%}
